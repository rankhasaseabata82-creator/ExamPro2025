<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
        .timer {
            font-size: 1.4rem;
            font-weight: 600;
            color: #dc3545;
        }
        .question-nav .nav-pills .nav-link {
            width: 42px;
            height: 42px;
            padding: 0;
            line-height: 42px;
            text-align: center;
            margin: 4px;
            border-radius: 50%;
        }
        .question-nav .nav-pills .nav-link.active {
            background-color: #0d6efd;
        }
        .options-list {
            list-style: none;
            padding-left: 0;
        }
        .options-list li {
            margin-bottom: .75rem;
        }
    </style>
</head>
<body class="bg-light">

<nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid">
        <span class="navbar-brand mb-0 h1">
            <i class="bi bi-mortarboard-fill me-2"></i>Student Dashboard
        </span>
        <a href="Index.html" class="btn btn-sm btn-outline-light">
            <i class="bi bi-house-door"></i> Home
        </a>
    </div>
</nav>

<div class="container py-4">

    <div class="card mb-4">
        <div class="card-header bg-primary text-white">
            <i class="bi bi-pencil-square me-2"></i>Live Exam
        </div>
        <div class="card-body">
            <h5 class="mb-1">Mathematics Midterm</h5>
            <p class="text-muted mb-3">
                Answer all questions. You have 90 minutes to complete this exam.
            </p>
        
<div class="card mb-4">
  <div class="card-header bg-success text-white">
    <i class="bi bi-award me-2"></i>Your Results
  </div>
  <div class="card-body px-0">
    <div class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th>Exam</th>
            <th>Score</th>
            <th class="d-none d-md-table-cell">Date Taken</th>
            <th></th>
          </tr>
        </thead>
        <tbody id="results-tbody"></tbody>
      </table>
    </div>
  </div>
</div>
            <button id="btn-continue" class="btn btn-success">
                <i class="bi bi-play-fill"></i> Continue Exam
            </button>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-secondary text-white">
            <i class="bi bi-clock-history me-2"></i>Past Exams
        </div>
        <div class="card-body px-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Exam</th>
                            <th>Score</th>
                            <th class="d-none d-md-table-cell">Date</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="past-exams-tbody"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header bg-info text-white">
            <i class="bi bi-collection me-2"></i>Available Exams
        </div>
        <div class="card-body px-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Exam</th>
                            <th class="d-none d-md-table-cell">Duration</th>
                            <th class="d-none d-md-table-cell">Questions</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="available-exams-tbody"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<div id="live-exam-container" class="container py-4 d-none">
    <div class="card mb-4">
        <div class="card-body">
            <h2 id="live-exam-title" class="mb-1">Mathematics Midterm</h2>
            <p id="live-exam-instructions" class="text-muted mb-0">
                Answer all questions. You have 90 minutes to complete this exam.
            </p>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-3 mb-4">
            <div class="card shadow-sm">
                <div class="card-header bg-white fw-semibold">Questions</div>
                <div class="card-body">
                    <div class="question-nav d-flex flex-wrap" id="question-nav"></div>
                </div>
            </div>
        </div>

        <div class="col-lg-9">
            <div class="card shadow-sm">
                <div class="card-body">
                    <div id="question-text" class="mb-4"></div>
                    <ul class="options-list" id="options-list"></ul>
                    <div class="d-flex justify-content-between mt-4">
                        <button class="btn btn-outline-secondary" id="prev-question">
                            <i class="bi bi-chevron-left"></i> Previous
                        </button>
                        <button class="btn btn-success" id="submit-exam">
                            <i class="bi bi-check-circle"></i> Submit Exam
                        </button>
                        <button class="btn btn-primary" id="next-question">
                            Next <i class="bi bi-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>

document.getElementById('submit-exam').addEventListener('click', () => {
  if (!confirm('Are you sure you want to submit the exam?')) return;

 
  const score = Math.round(Math.random() * 40 + 60); 

 
  const bc = new BroadcastChannel('exam_results');
  bc.postMessage({
    student: 'Student ' + Math.floor(Math.random() * 1000), 
    exam: 'Mathematics Midterm',                           
    score: score,
    date: new Date().toISOString().slice(0, 10)
  });

 
  alert('Exam submitted. Your score: ' + score + '%');

});

let questions = []; 

const qc = new BroadcastChannel('exam_data');
qc.onmessage = (e) => {
  questions = e.data;
  buildNav();         
  renderQuestion(0);  
};

qc.postMessage('sync'); 
let current = 0;

function buildNav() {
    const nav = document.getElementById('question-nav');
    nav.innerHTML = '';
    questions.forEach((_, idx) => {
        const btn = document.createElement('button');
        btn.className = 'nav-link';
        btn.textContent = idx + 1;
        btn.onclick = () => renderQuestion(idx);
        if (idx === current) btn.classList.add('active');
        nav.appendChild(btn);
    });
}


function renderQuestion(index) {
    current = index;
    document.getElementById('question-text').textContent = `${index + 1}. ${questions[index].q}`;
    const optList = document.getElementById('options-list');
    optList.innerHTML = '';
    questions[index].options.forEach(opt => {
        const li = document.createElement('li');
        li.innerHTML = `
            <div class="form-check">
                <input class="form-check-input" type="radio" name="q${index}" value="${opt}" id="${opt}">
                <label class="form-check-label" for="${opt}">${opt}</label>
            </div>`;
        optList.appendChild(li);
    });
    document.querySelectorAll('.question-nav .nav-link').forEach((p, i) =>
        p.classList.toggle('active', i === index)
    );
}


document.getElementById('prev-question').addEventListener('click', () => {
    if (current > 0) renderQuestion(current - 1);
});
document.getElementById('next-question').addEventListener('click', () => {
    if (current < questions.length - 1) renderQuestion(current + 1);
});
document.getElementById('submit-exam').addEventListener('click', () => {
  if (!confirm('Are you sure you want to submit the exam?')) return;

  
  const result = {
    student: 'Student ' + Math.floor(Math.random() * 1000), 
    exam: document.getElementById('live-exam-title').textContent.trim(),
    score: Math.round(Math.random() * 40 + 60), 
    date: new Date().toISOString().slice(0, 10)
  };

  
  const bc = new BroadcastChannel('exam_results');
  bc.postMessage(result);


  const row = document.createElement('tr');
  row.innerHTML = `
    <td>${result.exam}</td>
    <td><span class="badge bg-success">${result.score}%</span></td>
    <td class="d-none d-md-table-cell">${result.date}</td>
    <td><button class="btn btn-sm btn-outline-primary" onclick="alert('Review not implemented')"><i class="bi bi-eye"></i> Review</button></td>`;
  document.getElementById('results-tbody').prepend(row);

 
  alert('Exam submitted. Your score: ' + result.score + '%');
  
});


document.getElementById('btn-continue').addEventListener('click', () => {
    document.querySelector('.container.py-4').classList.add('d-none');
    document.getElementById('live-exam-container').classList.remove('d-none');
    buildNav();
    renderQuestion(0);
});

function loadTables() {
    document.getElementById('past-exams-tbody').innerHTML = pastExams.map(ex => `
        <tr>
            <td>${ex.name}</td>
            <td><span class="badge bg-primary">${ex.score}%</span></td>
            <td class="d-none d-md-table-cell">${ex.date}</td>
            <td><a class="btn btn-sm btn-outline-secondary" href="result.html?exam=${ex.name}">View</a></td>
        </tr>`).join('');

    document.getElementById('available-exams-tbody').innerHTML = availableExams.map(ex => `
        <tr>
            <td>${ex.name}</td>
            <td class="d-none d-md-table-cell">${ex.duration} min</td>
            <td class="d-none d-md-table-cell">${ex.questions}</td>
            <td>
                <a class="btn btn-sm btn-success" href="exam_page.html?examId=${ex.id}" target="_blank">
                    <i class="bi bi-box-arrow-up-right"></i> Start
                </a>
            </td>
        </tr>`).join('');
}
loadTables();

const results = [
  { exam: 'Math Mid-Term', score: 87, date: '2025-11-09' },
  { exam: 'English Essay', score: 92, date: '2025-11-05' },
  { exam: 'Physics Quiz',  score: 78, date: '2025-11-01' }
];

function loadResults() {
  document.getElementById('results-tbody').innerHTML = results.map(r => `
    <tr>
      <td>${r.exam}</td>
      <td><span class="badge bg-success">${r.score}%</span></td>
      <td class="d-none d-md-table-cell">${r.date}</td>
      <td>
        <button class="btn btn-sm btn-outline-primary"
                onclick="alert('Full review not implemented yet')">
          <i class="bi bi-eye"></i> Review
        </button>
      </td>
    </tr>`).join('');
}
loadResults();
</script>
</body>
</html>